@page "/inventory"
@using MDAS.Components.Layout
@using MDAS.Data
@inject InventoryServices Service
@layout AdminLayout

<PageTitle>Midas - Inventory</PageTitle>

<div class="container-fluid p-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold text-navy">Inventory Asset Manager</h2>
            <p class="text-muted">Master Product List & Stock Matrix</p>
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-outline-secondary rounded-pill" @onclick="GenerateSampleData">
                <i class="bi bi-database-add me-2"></i>Generate Sample Data
            </button>
            <button class="btn btn-navy px-4 rounded-pill">
                <i class="bi bi-plus-lg me-2"></i>New Product
            </button>
        </div>
    </div>

    <div class="card border-0 shadow-sm rounded-4">
        <div class="card-body p-0">
            <div class="table-responsive">
                @if (Products == null)
                {
                    <div class="p-5 text-center text-muted">Loading SQL Data...</div>
                }
                else if (Products.Count == 0)
                {
                    <div class="p-5 text-center text-muted">
                        No products found in database.
                    </div>
                }
                else
                {
                    <table class="table table-hover align-middle mb-0">
                        <thead class="bg-light">
                            <tr>
                                <th class="ps-4">Product Name</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Stock</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Products)
                            {
                                <tr>
                                    <td class="ps-4 fw-bold">@item.Name</td>
                                    <td><span class="badge bg-light text-dark border">@item.Category</span></td>
                                    <td class="fw-bold">₱ @item.Price.ToString("N2")</td>
                                    <td>@item.Stock</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-danger" @onclick="() => DeleteProduct(item)">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
            </div>
        </div>
    </div>
</div>

<style>
    .text-navy { color: #02001E; }
    .btn-navy { background-color: #02001E; color: white; }
</style>

@code {
    private List<Product>? Products;

    protected override async Task OnInitializedAsync()
    {
        await LoadData();
    }

    private async Task LoadData()
    {
        try 
        {
            Products = await Service.GetAllProductsAsync();
        }
        catch
        {
            Products = new List<Product>();
        }
    }

    private async Task GenerateSampleData()
    {
        await Service.GenerateSampleDataAsync();
        await LoadData();
    }

    private async Task DeleteProduct(Product p)
    {
        await Service.DeleteProductAsync(p);
        await LoadData();
    }
}